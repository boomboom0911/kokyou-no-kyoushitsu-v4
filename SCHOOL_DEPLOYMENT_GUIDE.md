# 🏫 コウキョウのキョウシツ v4 - 学校導入ガイド

## 📋 目次
1. [導入の概要](#導入の概要)
2. [必要なもの](#必要なもの)
3. [導入手順（ステップバイステップ）](#導入手順ステップバイステップ)
4. [初期設定](#初期設定)
5. [運用開始](#運用開始)
6. [トラブルシューティング](#トラブルシューティング)
7. [よくある質問](#よくある質問)

---

## 導入の概要

### このアプリケーションについて

「コウキョウのキョウシツ v4」は、教室での議論を可視化・活性化するWebアプリケーションです。
各学校が**独自のインスタンス**を持ち、生徒データと授業データを独立して管理します。

### 導入モデル

```
あなたの学校専用環境:
┌──────────────────────┐
│ Supabase             │  ← あなたの学校のデータベース
│ (データベース)        │     (生徒データ・授業データを保存)
└──────────────────────┘
         ↕
┌──────────────────────┐
│ Vercel               │  ← あなたの学校専用のWebアプリ
│ (Webアプリケーション) │     (https://あなたの学校名.vercel.app)
└──────────────────────┘
```

### メリット
- ✅ **データの独立性**: 他校とデータが混ざらない
- ✅ **カスタマイズ可能**: 学校の環境に合わせて調整可能
- ✅ **無料運用**: Vercel・Supabaseの無料プランで十分
- ✅ **メンテナンス不要**: サーバー管理の必要なし

### 所要時間
- **初めての導入**: 約1時間
- **2回目以降**: 約30分

---

## 必要なもの

### 必須アカウント（すべて無料）

1. **GitHubアカウント**
   - サインアップ: https://github.com/signup
   - コードのコピー（フォーク）に使用

2. **Supabaseアカウント**
   - サインアップ: https://supabase.com
   - データベースの作成に使用

3. **Vercelアカウント**
   - サインアップ: https://vercel.com
   - Webアプリのデプロイに使用

### 準備するデータ

- **生徒リスト**: Excelやスプレッドシートで
  - メールアドレス（Google Workspace推奨）
  - 学籍番号
  - 氏名
  - クラス

---

## 導入手順（ステップバイステップ）

### フェーズ1: GitHubリポジトリのフォーク（5分）

#### 1-1. GitHubにログイン
https://github.com にアクセスしてログイン

#### 1-2. リポジトリをフォーク
1. https://github.com/boomboom0911/kokyou-no-kyoushitsu-v4 にアクセス
2. 右上の「Fork」ボタンをクリック
3. 「Create fork」をクリック
4. あなたのアカウントにコピーが作成されます

**結果**: `https://github.com/あなたのユーザー名/kokyou-no-kyoushitsu-v4` が作成される

---

### フェーズ2: Supabaseプロジェクトの作成（20分）

#### 2-1. Supabaseにログイン
https://supabase.com にアクセスしてログイン

#### 2-2. 新規プロジェクトを作成
1. 「New Project」をクリック
2. 以下を入力:
   - **Name**: `kokyou-no-kyoushitsu-あなたの学校名`
   - **Database Password**: 安全なパスワードを設定（メモしておく）
   - **Region**: `Northeast Asia (Tokyo)` を選択
3. 「Create new project」をクリック
4. 数分待つ（プロジェクトが作成されるまで）

#### 2-3. データベース情報をメモ
1. プロジェクトが作成されたら、左メニューの「Settings」→「API」を開く
2. 以下の情報をメモ:
   - **Project URL**: `https://xxxxx.supabase.co`
   - **anon public**: `eyJhbGciOiJIUzI1NiIsInR5cCI6...` （長い文字列）

#### 2-4. データベーステーブルを作成

1. 左メニューの「SQL Editor」を開く
2. 「New query」をクリック
3. GitHubリポジトリの `supabase-schema-clean.sql` の内容をコピー&ペースト
4. 「Run」をクリック
5. 9つのテーブルが作成されたことを確認（左メニューの「Table Editor」で確認）

#### 2-5. クラスデータを登録

1. SQL Editorで新しいクエリを作成
2. 以下のSQLを実行（クラス名は学校に合わせて変更）:

```sql
INSERT INTO classes (name, grade) VALUES
('2-1', 2),
('2-2', 2),
('2-3', 2),
('2-4', 2),
('2-5', 2);
```

3. 「Run」をクリック

#### 2-6. 生徒データを登録

**方法A: SQL で直接登録**

```sql
INSERT INTO students (google_email, class_id, student_number, display_name) VALUES
('2101@あなたの学校のドメイン', 1, '2101', '山田太郎'),
('2102@あなたの学校のドメイン', 1, '2102', '佐藤花子'),
-- 以下、各生徒分を追加
;
```

**方法B: CSV インポート（推奨）**

1. Table Editor → `students` テーブルを開く
2. 「Insert」→「Import data from CSV」
3. 生徒リストのCSVをアップロード

**CSV形式例**:
```csv
google_email,class_id,student_number,display_name
2101@school.ed.jp,1,2101,山田太郎
2102@school.ed.jp,1,2102,佐藤花子
```

---

### フェーズ3: Vercelへのデプロイ（15分）

#### 3-1. Vercelにログイン
https://vercel.com にアクセスして、GitHubアカウントでログイン

#### 3-2. 新規プロジェクトを作成
1. 「Add New...」→「Project」をクリック
2. 「Import Git Repository」で、先ほどフォークしたリポジトリを選択
3. 「Import」をクリック

#### 3-3. 環境変数を設定

「Environment Variables」セクションで以下を追加:

| Key | Value |
|-----|-------|
| `NEXT_PUBLIC_TEACHER_PASSWORD` | 教師用のパスワード（自由に設定） |
| `NEXT_PUBLIC_SUPABASE_URL` | Supabaseの Project URL |
| `NEXT_PUBLIC_SUPABASE_ANON_KEY` | Supabaseの anon public キー |

**入力方法**:
1. Key欄に変数名を入力
2. Value欄に値を入力
3. 「Add」をクリック
4. 3つすべて追加する

#### 3-4. デプロイ
1. 「Deploy」ボタンをクリック
2. 2-3分待つ
3. デプロイ完了！

#### 3-5. URLを確認
- デプロイ完了後、URLが表示されます
- 例: `https://kokyou-no-kyoushitsu-v4.vercel.app`
- このURLがあなたの学校専用のアプリURLです

---

## 初期設定

### 動作確認（5分）

#### テスト1: 教師ログイン
1. VercelのURLにアクセス
2. 「教師用」で、設定したパスワードでログイン
3. セッション作成画面が表示されることを確認

#### テスト2: セッション作成
1. クラスを選択（例: 2-1）
2. タイトル: `テストセッション`
3. 内容: `動作確認`
4. 時限: `1`
5. 「セッションを作成」をクリック
6. 4桁コードが生成されることを確認

#### テスト3: 生徒ログイン
1. 別のブラウザタブで同じURLを開く
2. 「生徒用」で「授業に参加」を選択
3. 生成されたセッションコードを入力
4. 登録した生徒のメールアドレスを入力
5. 座席選択画面が表示されることを確認

#### テスト4: 投稿機能
1. 座席を選択
2. トピックを投稿
3. 教師画面で投稿が表示されることを確認

**すべて正常に動作すれば、導入完了です！** 🎉

---

## 運用開始

### 教師への案内

**URLを共有**:
```
あなたの学校のコウキョウのキョウシツ:
https://あなたのプロジェクト名.vercel.app

教師パスワード: xxxxxxx
```

### 生徒への案内

**配布資料例**:

```
===========================================
コウキョウのキョウシツ v4 使い方
===========================================

【アクセス方法】
https://あなたのプロジェクト名.vercel.app

【ログイン方法】
1. 「生徒用」を選択
2. 「授業に参加」を選択
3. 先生から伝えられた4桁のコードを入力
4. 学校のメールアドレスを入力
   （例: あなたの学籍番号@学校のドメイン）

【基本的な使い方】
1. 座席を選ぶ
2. 先生の質問に答える（トピック投稿）
3. 友達の意見を読む
4. リアクションやコメントをする
5. チャットで議論する

【ポートフォリオ】
「ポートフォリオ」を選択すると、過去の学習記録を
確認したり、CSVでダウンロードできます。
===========================================
```

---

## トラブルシューティング

### ❌ ログインできない

**症状**: パスワードが正しくありません

**原因**: 環境変数の設定ミス

**解決策**:
1. Vercelのプロジェクト設定を開く
2. 「Settings」→「Environment Variables」
3. `NEXT_PUBLIC_TEACHER_PASSWORD` の値を確認
4. 再デプロイ（「Deployments」→「Redeploy」）

---

### ❌ 生徒データが見つからない

**症状**: メールアドレスを入力しても「生徒が見つかりません」

**原因**: Supabaseに生徒データが登録されていない

**解決策**:
1. Supabaseにログイン
2. Table Editor → `students` テーブルを開く
3. 生徒データが登録されているか確認
4. 登録されていなければ、CSVインポートまたはSQL で追加

---

### ❌ セッションが作成できない

**症状**: 「セッション作成に失敗しました」

**原因**: クラスデータが登録されていない

**解決策**:
1. Supabaseにログイン
2. Table Editor → `classes` テーブルを開く
3. クラスデータが登録されているか確認
4. 登録されていなければ、SQL で追加

---

### ❌ 座席マップが表示されない

**症状**: 座席選択画面で座席が表示されない

**原因**: データベース接続エラー

**解決策**:
1. Vercelの環境変数を確認
2. `NEXT_PUBLIC_SUPABASE_URL` と `NEXT_PUBLIC_SUPABASE_ANON_KEY` が正しいか確認
3. Supabaseのプロジェクトが起動しているか確認
4. Vercelで再デプロイ

---

## よくある質問

### Q1: 複数の学年で使えますか？

**A**: はい。`classes` テーブルに学年ごとのクラスを追加してください。

```sql
INSERT INTO classes (name, grade) VALUES
('1-1', 1),
('1-2', 1),
('2-1', 2),
('2-2', 2),
('3-1', 3),
('3-2', 3);
```

---

### Q2: 生徒を追加・削除するには？

**A**: Supabaseの Table Editor で直接編集できます。

**追加**:
1. Table Editor → `students`
2. 「Insert row」をクリック
3. 情報を入力

**削除**:
1. Table Editor → `students`
2. 該当の行を選択
3. 「Delete」をクリック

---

### Q3: 過去のセッションデータを削除するには？

**A**: Supabaseの Table Editor または SQL で削除できます。

```sql
-- 特定のセッションを削除
DELETE FROM lesson_sessions WHERE id = 123;

-- 古いセッションを一括削除（例: 2024年より前）
DELETE FROM lesson_sessions WHERE started_at < '2024-01-01';
```

---

### Q4: 独自ドメイン（例: classroom.school.ed.jp）を使いたい

**A**: Vercelの Custom Domains 機能で設定できます。

1. Vercelプロジェクト設定 → 「Domains」
2. 「Add Domain」をクリック
3. ドメイン名を入力
4. DNS設定を行う（Vercelが手順を表示）

---

### Q5: データのバックアップは？

**A**: Supabaseで定期的にバックアップを取ることを推奨します。

**手動バックアップ**:
1. Supabaseプロジェクト設定 → 「Database」
2. 「Backups」タブ
3. 「Download Backup」をクリック

**自動バックアップ**:
- Supabaseの有料プラン（Pro）で自動バックアップが有効

---

### Q6: 費用はかかりますか？

**A**: 基本的に無料です。

| サービス | 無料枠 | 超過時 |
|----------|--------|--------|
| Vercel | 100GB帯域/月 | 従量課金 |
| Supabase | 500MB DB / 2GB帯域/月 | 従量課金 |

**目安**: 生徒100名、月20セッションで無料枠内で運用可能

---

### Q7: セキュリティは大丈夫？

**A**: 以下のセキュリティ対策が実装されています。

- ✅ **HTTPS通信**: すべての通信が暗号化
- ✅ **Row Level Security (RLS)**: データベースレベルでアクセス制御
- ✅ **環境変数化**: パスワードなどの機密情報を安全に管理
- ✅ **認証**: 学校のメールアドレスでログイン

**追加推奨事項**:
- 教師パスワードは定期的に変更
- 生徒に学校のメールアドレスのみ使用させる

---

### Q8: カスタマイズできますか？

**A**: はい！オープンソースなので自由にカスタマイズできます。

**例**:
- 座席数の変更（42席 → 任意の数）
- デザインの変更（色、レイアウト）
- 機能の追加（独自のリアクション、評価機能など）

**手順**:
1. フォークしたGitHubリポジトリをクローン
2. ローカルで開発・テスト
3. GitHubにプッシュ
4. Vercelが自動デプロイ

---

### Q9: サポートはありますか？

**A**: 以下の方法でサポートを受けられます。

1. **GitHubのIssues**: https://github.com/boomboom0911/kokyou-no-kyoushitsu-v4/issues
2. **README.md**: 詳細なドキュメント
3. **コミュニティ**: 他の学校とのノウハウ共有

---

### Q10: アップデートはありますか？

**A**: GitHubリポジトリが更新された場合、以下の手順で取り込めます。

1. あなたのフォークしたリポジトリページを開く
2. 「Sync fork」ボタンをクリック
3. 「Update branch」をクリック
4. Vercelが自動的に再デプロイ

---

## 📞 お問い合わせ

### 技術的な問題
GitHubのIssues: https://github.com/boomboom0911/kokyou-no-kyoushitsu-v4/issues

### 機能改善の提案
Pull Requestを送信してください！

### その他
README.mdの「開発者」セクションを参照

---

## 🎉 導入が完了したら

**おめでとうございます！** あなたの学校専用の「コウキョウのキョウシツ」が完成しました。

生徒たちの議論が活性化し、学びが深まることを願っています。

**2025年 - 次世代の教育を、あなたの学校から** 🚀
