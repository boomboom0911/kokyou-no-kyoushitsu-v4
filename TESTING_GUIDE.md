# 🧪 公共のキョウシツ v4 - テスト手順書

**作成日**: 2025年10月8日
**テスト対象**: kokyou-no-kyoushitsu-v4
**開発サーバー**: http://localhost:3002

---

## 📋 事前準備

### 1. データベースのセットアップ

1. Supabaseダッシュボードにアクセス
   - URL: https://xaajfdlatxqocuklqqfo.supabase.co

2. SQL Editorを開く（左サイドバー）

3. `supabase-schema.sql` の内容を実行
   - ファイルパス: `/Users/boomboom0911/Developer/kokyou-no-kyoushitsu-v4/supabase-schema.sql`
   - 全て選択してコピー → SQL Editorに貼り付け → Run

4. 実行完了を確認
   - エラーがないことを確認
   - Table Editorで10個のテーブルが作成されていることを確認
     - classes
     - students
     - lesson_sessions
     - seat_assignments
     - topic_posts
     - chat_messages
     - reactions
     - interactions
     - learning_memos
     - export_history

### 2. 開発サーバーの起動確認

```bash
# 既に起動中の場合はスキップ
cd /Users/boomboom0911/Developer/kokyou-no-kyoushitsu-v4
npm run dev
```

ブラウザで http://localhost:3002 を開いて、トップページが表示されることを確認

---

## 🧑‍🏫 テスト1: 教師フロー

### 1-1. 教師ログイン

1. http://localhost:3002 にアクセス
2. 「👨‍🏫 教師ダッシュボード」カードをクリック
3. パスワード入力: `teacher2025`
4. 「ログイン」ボタンをクリック

**期待結果**:
- セッション作成画面（/teacher/create-session）に遷移
- 「新規セッション作成」と表示される

### 1-2. セッション作成

1. フォームに以下を入力:
   - **授業タイトル**: `テスト授業: SDGsについて`
   - **授業内容**: `持続可能な開発目標について議論しよう`
   - **日付**: 今日の日付を選択
   - **時限**: `3`

2. 「セッション作成」ボタンをクリック

**期待結果**:
- 4桁のセッションコードが生成される（例: AB12）
- 教師ダッシュボード（/teacher/dashboard/[sessionCode]）に遷移
- 統計情報が表示される:
  - 参加者数: 0
  - 投稿済み: 0
  - 投稿率: 0%

**⚠️ 重要**: 生成されたセッションコードをメモしておく（生徒ログインで使用）

### 1-3. ダッシュボード確認

1. 「🗺️ 座席マップ」タブが選択されていることを確認
2. 42席の座席表が表示されることを確認
3. 全ての座席が空席（グレー）であることを確認
4. 「🔄 自動更新ON」が緑色で表示されていることを確認

**期待結果**:
- 座席表が7行×6列で表示される
- 自動更新が有効（5秒ごとにデータ取得）

---

## 👨‍🎓 テスト2: 生徒フロー（生徒A）

**新しいブラウザウィンドウまたはシークレットモードで実行**

### 2-1. 生徒ログイン

1. http://localhost:3002 にアクセス
2. 「👨‍🎓 生徒ログイン」カードをクリック
3. フォームに以下を入力:
   - **セッションコード**: （教師が生成した4桁コード）
   - **メールアドレス**: `student1@school.ed.jp`

4. 「ログイン」ボタンをクリック

**期待結果**:
- 教室画面（/classroom/[sessionCode]）に遷移
- 「座席を選択してください」と表示される
- 42席の座席表が表示される

### 2-2. 座席選択

1. 座席番号「5」をクリック（2行目、左から5番目）

**期待結果**:
- 座席5が青色（選択中）にハイライトされる
- 「トピックを投稿」セクションが表示される
- 「あなたの座席: 5番」と表示される

### 2-3. トピック投稿

1. テキストエリアに以下を入力:
   ```
   SDGsで最も重要なのは「目標13: 気候変動に具体的な対策を」だと思います。
   地球温暖化は全ての目標に影響するため、最優先で取り組むべきです。
   ```

2. 「投稿する」ボタンをクリック

**期待結果**:
- 「投稿が完了しました！」メッセージが表示される
- 「みんなの意見を見る」ボタンが表示される

### 2-4. 教師ダッシュボードで確認

**教師のブラウザウィンドウに戻る**

1. 統計情報を確認:
   - 参加者数: 1
   - 投稿済み: 1
   - 投稿率: 100%

2. 座席マップで座席5を確認:
   - 座席5が緑色（投稿済み）になっている
   - 座席5に生徒名「student1」が表示されている
   - 投稿内容のプレビューが表示されている

3. 「💬 投稿一覧」タブをクリック

**期待結果**:
- 投稿一覧に1件のTopicCardが表示される
- 投稿者: student1
- 座席番号: 5番
- 投稿内容が全文表示される
- リアクションバー（驚・納・疑）が表示される（カウントは全て0）

---

## 👨‍🎓 テスト3: 生徒フロー（生徒B）

**さらに別のブラウザウィンドウまたはシークレットモードで実行**

### 3-1. 生徒ログインと座席選択

1. http://localhost:3002 にアクセス
2. 「生徒ログイン」をクリック
3. 認証情報入力:
   - セッションコード: （同じコード）
   - メールアドレス: `student2@school.ed.jp`
4. ログイン後、座席番号「12」を選択

### 3-2. トピック投稿

テキストエリアに以下を入力:
```
私は「目標4: 質の高い教育をみんなに」が重要だと考えます。
教育があれば人々は自ら問題を解決する力を持てるからです。
```

投稿ボタンをクリック

### 3-3. ディスカッション画面へ移動

1. 「みんなの意見を見る」ボタンをクリック

**期待結果**:
- ディスカッション画面（/classroom/[sessionCode]/discussion）に遷移
- 2件のTopicCardが表示される:
  - student1の投稿（座席5）
  - student2の投稿（座席12）

---

## 💬 テスト4: リアクション機能

**生徒Bのブラウザ（ディスカッション画面）で実行**

### 4-1. リアクション追加

1. student1の投稿カードを見つける
2. リアクションバーの「驚」ボタンをクリック

**期待結果**:
- 「驚」ボタンが黄色にハイライトされる
- カウントが「0」→「1」に増える

3. 続けて「納」ボタンをクリック

**期待結果**:
- 「納」ボタンも黄色にハイライトされる
- カウントが「0」→「1」に増える

### 4-2. リアクション削除

1. 「驚」ボタンをもう一度クリック

**期待結果**:
- 「驚」のハイライトが解除される
- カウントが「1」→「0」に戻る

### 4-3. 教師ダッシュボードで確認

**教師のブラウザに戻る**

1. 「💬 投稿一覧」タブを表示
2. student1の投稿を確認

**期待結果**:
- リアクションカウントが自動更新される（5秒以内）
- 「納」が1件表示される

---

## 📝 テスト5: 学習メモ機能（QuickMemo）

**生徒Aのブラウザで実行**

### 5-1. QuickMemoを開く

1. ディスカッション画面の右下に浮遊ボタン「📝」があることを確認
2. 「📝」ボタンをクリック

**期待結果**:
- メモ入力パネルが展開される
- テキストエリアとタグ入力欄が表示される

### 5-2. メモ作成

1. テキストエリアに以下を入力:
   ```
   student2の意見で「教育があれば自ら解決できる」という視点が新しかった。
   確かに、教育は全ての目標の基盤になるかもしれない。
   ```

2. タグ入力欄に `SDGs, 気づき` と入力

3. 「保存」ボタンをクリック

**期待結果**:
- 「メモを保存しました」メッセージが表示される
- パネルが閉じる

---

## 📚 テスト6: ポートフォリオ機能

**生徒Aのブラウザで実行**

### 6-1. ポートフォリオ画面へ移動

1. ブラウザのアドレスバーで http://localhost:3002/student/menu にアクセス
2. 「マイポートフォリオ」カードをクリック

**期待結果**:
- ポートフォリオ画面（/student/portfolio）に遷移
- 学習メモが1件表示される
- タグ「SDGs」「気づき」が表示される
- 関連セッション「テスト授業: SDGsについて」が表示される

### 6-2. CSVエクスポート

1. 「📥 CSVエクスポート」ボタンをクリック

**期待結果**:
- CSVファイル `my-portfolio-YYYYMMDD.csv` がダウンロードされる
- ExcelまたはNumbers/LibreOfficeで開いて内容確認:
  - ヘッダー: ID, 作成日時, 内容, タグ, お気に入り, セッションタイトル
  - 1行目のデータが正しく表示される
  - 日本語が文字化けしていない（BOM付きUTF-8）

---

## 🎯 テスト7: 統合確認

### 7-1. 3人目の生徒を追加

**新しいブラウザで実行**

1. 生徒ログイン: `student3@school.ed.jp`
2. 座席選択: 18番
3. トピック投稿:
   ```
   「目標17: パートナーシップで目標を達成しよう」が鍵だと思います。
   1つの国や組織だけでは解決できない問題が多いからです。
   ```

### 7-2. 教師ダッシュボード最終確認

**教師のブラウザで確認**

**統計情報**:
- 参加者数: 3
- 投稿済み: 3
- 投稿率: 100%

**座席マップ**:
- 座席5（student1）、座席12（student2）、座席18（student3）が緑色
- 残り39席は空席（グレー）

**投稿一覧**:
- 3件のTopicCardが表示される
- それぞれ異なる投稿内容とリアクションバー

### 7-3. 自動更新のテスト

1. 教師ダッシュボードで「⏸️ 自動更新OFF」ボタンをクリック
2. 生徒Bのブラウザで新しいメモを作成
3. 5秒待機
4. 教師ダッシュボードに変化がないことを確認
5. 「🔄 自動更新ON」ボタンをクリック
6. 5秒以内に統計情報が更新されることを確認

---

## ✅ テスト完了チェックリスト

- [ ] 教師ログイン成功
- [ ] セッション作成成功（4桁コード生成）
- [ ] 生徒ログイン成功（複数アカウント）
- [ ] 座席選択機能（重複防止）
- [ ] トピック投稿機能
- [ ] 座席マップ表示（42席）
- [ ] 投稿一覧表示
- [ ] リアクション追加/削除（驚・納・疑）
- [ ] リアクションカウント更新
- [ ] QuickMemo（学習メモ作成）
- [ ] ポートフォリオ画面表示
- [ ] CSVエクスポート（文字化けなし）
- [ ] 統計情報表示（参加者数・投稿数・投稿率）
- [ ] 自動更新ON/OFF切り替え
- [ ] 視点切り替え（座席マップ/投稿一覧）

---

## 🐛 バグ報告テンプレート

問題が見つかった場合は、以下の形式で記録してください:

```markdown
### バグ報告

**発生日時**: 2025-10-08 XX:XX

**再現手順**:
1. ...
2. ...
3. ...

**期待される動作**:
...

**実際の動作**:
...

**エラーメッセージ**:
...

**スクリーンショット**:
（あれば添付）

**環境**:
- ブラウザ: Chrome/Safari/Firefox
- OS: macOS/Windows
- 開発サーバー: http://localhost:3002
```

---

## 📞 サポート

質問や問題があれば、開発者にお知らせください。

**開発環境**: Next.js 15.5.4 + TypeScript 5.3.3 + Supabase
**作成者**: Claude Code & User
